# サイト運営自動化ロードマップ

## ゴール
- 情報収集の自動化
- 真偽判定の自動化（ただし完全断定ではなく、信頼度評価 + 要レビュー判定を基本にする）
- 自動アップロード（公開反映）

## 前提
- このサイトは「作中事実」と「評価/解釈」を分離して扱う
- 自動化対象はまず `事実候補の収集・整形・検証補助` を優先する
- 議論性の高い項目は最終的に人間レビューを通す

## 現在の進捗（2026-02-23）
- 完了: サイト内バージョン表示（`app.js` の単一点管理）
- 完了: エントリデータの外部化（`entries.json`）
- 完了: ローカル簡易バリデータ（`scripts/validate-entries.mjs`）
- 完了: GitHub Actions でバリデーション自動実行
- 完了: リリース手順（バージョン更新 + validate + commit/push）スクリプト追加（`scripts/release.mjs`）
- 完了: Vercel デプロイ設定（`vercel.json` / `.vercelignore`）
- 完了: 日次自動実行ワークフロー（1日1回, `automation-daily.yml`）
- 完了: 自動化ポリシー設定（遅延・robots順守・閾値）を `automation.config.json` に集約
- 完了: 収集元定義（`sources.json`）の自動生成
- 完了: Fetcher 雛形（`scripts/fetch-sources.mjs` / dry-run 対応）
- 完了: スナップショット抽出（Extractor）雛形とレビューキュー生成（`scripts/extract-snapshots.mjs`）
- 完了: 抽出結果からエントリ候補JSONを作る変換器（Transformer）雛形
- 完了: 公開用ステータス/レビューFeed生成（`automation-status.json` / `automation-review-feed.json`）
- 完了: 日次ジョブの自動コミット（Vercel Git連携で自動反映）
- 完了: 候補JSONから `entries.json` へ昇格する Publisher（厳格自動 / `scripts/publish-candidates-to-entries.mjs`）
- 完了: 自動運営ステータスをサイトUIで可視化（運用監視導線）
- 次: Extractor/Transformer の精度向上（`suggestedEntry` 必須項目の自動充填率を上げる）

## 自動化の全体構成（目標アーキテクチャ）
1. ソース登録
- 作品ごとの一次/準一次ソースURLを管理する
- 取得対象の優先度（公式 > 信頼性の高いWiki > 二次記事）を持たせる

2. 収集（Fetcher）
- URL一覧を巡回して本文・見出し・更新日時を取得
- 取得結果をローカルにスナップショット保存
- 取得失敗や差分をログ化

3. 抽出（Extractor）
- 「要素名」「初出」「作中で示された事実」「その後の扱い」「出典URL」などの候補を抽出
- LLM を使う場合も、抽出元テキスト断片（根拠）を必ず保持

4. 検証（Verifier）
- 必須項目の欠落チェック
- URL生存チェック
- 同一作品内の重複候補チェック
- 断定表現の危険度チェック（例: 「確定」「公式に」など）
- 複数ソース間の矛盾検出（簡易）

5. 判定（Scoring / Review Queue）
- 自動で「掲載候補」「保留」「要レビュー」に振り分ける
- 真偽の完全自動断定は行わず、根拠量と整合性で信頼度をスコア化する

6. 公開（Publisher）
- 検証通過データをサイト用データへ反映
- バージョン番号を更新
- コミット / push / Vercel 反映（Git連携）

## 段階的実装プラン

### Phase 1: データ運用基盤（最優先）
- エントリデータを `app.js` から分離（JSON など）
- スキーマ定義（必須項目、型、文字数、URL）
- ローカル検証スクリプト（重複ID、必須漏れ、URL形式）
- バージョン管理の単一点化（今回着手済み）

### Phase 2: 収集の自動化
- ソース一覧ファイル作成（作品/URL/優先度）
- 取得スクリプト作成（HTML保存、更新差分）
- robots.txt / 利用規約の遵守ルールを明文化

### Phase 3: 真偽判定の自動化（補助中心）
- 抽出結果に根拠テキストを紐付け
- スコアリング（ソース数、整合性、断定語、更新鮮度）
- 要レビューキューを生成

### Phase 4: 自動公開
- 検証通過時の自動コミット
- GitHub Actions で build/validate/publish
- 失敗時の通知（Issue or Actions summary）

## 注意点（重要）
- 「真偽判定の自動化」は、実務上は「自動断定」より「誤判定を減らす補助」に寄せる方が安全です
- 特に制作都合・作者発言・インタビュー由来の項目は、文脈欠落で誤解しやすいため要レビューを基本にします
- 著作権・利用規約・アクセス頻度制限は初期段階から守る前提で設計します

## 次の実装候補（このリポジトリで順番にやる）
1. エントリデータの外部化（`entries.json` 化）
2. `validate` スクリプト追加（重複ID/必須項目/URL形式）
3. `release` スクリプト追加（バージョン更新 + commit + push）
4. GitHub Actions で validate 自動実行
